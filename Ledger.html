<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------</a>
<a id="44" class="Comment">-- ** Denotational &amp; operational semantics</a>

<a id="88" class="Keyword">module</a> <a id="95" href="Ledger.html" class="Module">Ledger</a> <a id="102" class="Keyword">where</a>

<a id="109" class="Keyword">open</a> <a id="114" class="Keyword">import</a> <a id="121" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="134" class="Keyword">open</a> <a id="139" class="Keyword">import</a> <a id="146" href="Prelude.General.html" class="Module">Prelude.General</a>
<a id="162" class="Keyword">open</a> <a id="167" class="Keyword">import</a> <a id="174" href="Prelude.Sets.html" class="Module">Prelude.Sets</a>
<a id="187" class="Keyword">open</a> <a id="192" class="Keyword">import</a> <a id="199" href="Prelude.Membership.html" class="Module">Prelude.Membership</a>

<a id="219" class="Keyword">open</a> <a id="224" class="Keyword">import</a> <a id="231" href="UTxO.html" class="Module">UTxO</a>

<a id="237" class="Comment">-- ** Denotational semantics</a>

<a id="267" class="Comment">-- The meaning of a transaction or a whole ledger will be denoted by state transformers,</a>
<a id="356" class="Comment">-- i.e. function from the current state to the updated one.</a>
<a id="Domain"></a><a id="416" href="Ledger.html#416" class="Function">Domain</a> <a id="423" class="Symbol">=</a> <a id="425" href="UTxO.html#1964" class="Function">S</a> <a id="427" class="Symbol">→</a> <a id="429" href="UTxO.html#1964" class="Function">S</a>

<a id="432" class="Keyword">record</a> <a id="Denotable"></a><a id="439" href="Ledger.html#439" class="Record">Denotable</a> <a id="449" class="Symbol">(</a><a id="450" href="Ledger.html#450" class="Bound">A</a> <a id="452" class="Symbol">:</a> <a id="454" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="457" class="Symbol">)</a> <a id="459" class="Symbol">:</a> <a id="461" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="465" class="Keyword">where</a>
  <a id="473" class="Keyword">field</a> <a id="Denotable.⟦_⟧"></a><a id="479" href="Ledger.html#479" class="Field Operator">⟦_⟧</a> <a id="483" class="Symbol">:</a> <a id="485" href="Ledger.html#450" class="Bound">A</a> <a id="487" class="Symbol">→</a> <a id="489" href="Ledger.html#416" class="Function">Domain</a>
<a id="496" class="Keyword">open</a> <a id="501" href="Ledger.html#439" class="Module">Denotable</a> <a id="511" class="Symbol">⦃...⦄</a> <a id="517" class="Keyword">public</a>

<a id="525" class="Keyword">instance</a>
  <a id="536" class="Comment">-- we denote a transaction as simply running the transaction based on the transfer operation above</a>
  <a id="⟦Tx⟧"></a><a id="637" href="Ledger.html#637" class="Function">⟦Tx⟧</a> <a id="642" class="Symbol">:</a> <a id="644" href="Ledger.html#439" class="Record">Denotable</a> <a id="654" href="UTxO.html#1441" class="Record">Tx</a>
  <a id="659" href="Ledger.html#637" class="Function">⟦Tx⟧</a> <a id="664" class="Symbol">.</a><a id="665" href="Ledger.html#479" class="Field Operator">⟦_⟧</a> <a id="669" href="Ledger.html#669" class="Bound">tx</a> <a id="672" href="Ledger.html#672" class="Bound">utxos</a> <a id="678" class="Symbol">=</a>
    <a id="684" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="687" href="UTxO.html#4437" class="Function">isValidTx</a> <a id="697" href="Ledger.html#669" class="Bound">tx</a> <a id="700" href="Ledger.html#672" class="Bound">utxos</a> <a id="706" href="Data.Bool.Base.html#1283" class="Function Operator">then</a>
        <a id="719" href="Prelude.Sets.Interface.html#3982" class="Function">fromList</a> <a id="728" class="Symbol">(</a><a id="729" href="Data.List.Base.html#8092" class="Function">filter</a> <a id="736" class="Symbol">((</a><a id="738" href="Prelude.Membership.html#502" class="Function Operator">_∉?</a> <a id="742" href="UTxO.html#2152" class="Function">outputRefs</a> <a id="753" href="Ledger.html#669" class="Bound">tx</a><a id="755" class="Symbol">)</a> <a id="757" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="759" href="UTxO.html#1777" class="Field">UTXO.outRef</a><a id="770" class="Symbol">)</a> <a id="772" class="Symbol">(</a><a id="773" href="Prelude.Sets.Interface.html#3955" class="Function">toList</a> <a id="780" href="Ledger.html#672" class="Bound">utxos</a><a id="785" class="Symbol">))</a>
      <a id="794" href="Prelude.Sets.Interface.html#504" class="Function Operator">∪</a> <a id="796" href="Prelude.Sets.Interface.html#3982" class="Function">fromList</a> <a id="805" class="Symbol">(</a><a id="806" href="Prelude.Membership.html#1190" class="Field">mapWith∈</a> <a id="815" class="Symbol">(</a><a id="816" href="Ledger.html#669" class="Bound">tx</a> <a id="819" class="Symbol">.</a><a id="820" href="UTxO.html#1495" class="Field">outputs</a><a id="827" class="Symbol">)</a> <a id="829" class="Symbol">(</a><a id="830" href="UTxO.html#1989" class="Function">mkUtxo</a> <a id="837" href="Ledger.html#669" class="Bound">tx</a><a id="839" class="Symbol">))</a>
    <a id="846" href="Data.Bool.Base.html#1283" class="Function Operator">else</a>
      <a id="857" href="Ledger.html#672" class="Bound">utxos</a>

  <a id="866" class="Comment">-- we denote a ledger as the composition of the denotations of its transactions,</a>
  <a id="949" class="Comment">-- i.e. we run all transactions in sequence</a>
  <a id="⟦L⟧"></a><a id="995" href="Ledger.html#995" class="Function">⟦L⟧</a> <a id="999" class="Symbol">:</a> <a id="1001" href="Ledger.html#439" class="Record">Denotable</a> <a id="1011" href="UTxO.html#1732" class="Function">L</a>
  <a id="1015" href="Ledger.html#995" class="Function">⟦L⟧</a> <a id="1019" class="Symbol">.</a><a id="1020" href="Ledger.html#479" class="Field Operator">⟦_⟧</a> <a id="1024" class="Symbol">=</a> <a id="1026" class="Symbol">λ</a> <a id="1028" class="Keyword">where</a>
    <a id="1038" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>      <a id="1046" class="Symbol">→</a> <a id="1048" href="Function.Base.html#615" class="Function">id</a>
    <a id="1055" class="Symbol">(</a><a id="1056" href="Ledger.html#1056" class="Bound">t</a> <a id="1058" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1060" href="Ledger.html#1060" class="Bound">l</a><a id="1061" class="Symbol">)</a> <a id="1063" class="Symbol">→</a> <a id="1065" href="Ledger.html#479" class="Field Operator">⟦</a> <a id="1067" href="Ledger.html#1060" class="Bound">l</a> <a id="1069" href="Ledger.html#479" class="Field Operator">⟧</a> <a id="1071" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="1073" href="Ledger.html#479" class="Field Operator">⟦</a> <a id="1075" href="Ledger.html#1056" class="Bound">t</a> <a id="1077" href="Ledger.html#479" class="Field Operator">⟧</a>

<a id="1080" class="Keyword">variable</a>
  <a id="1091" href="Ledger.html#1091" class="Generalizable">s</a> <a id="1093" href="Ledger.html#1093" class="Generalizable">s′</a> <a id="1096" href="Ledger.html#1096" class="Generalizable">s″</a> <a id="1099" href="Ledger.html#1099" class="Generalizable">s₁</a> <a id="1102" href="Ledger.html#1102" class="Generalizable">s₂</a> <a id="1105" class="Symbol">:</a> <a id="1107" href="UTxO.html#1964" class="Function">S</a>
  <a id="1111" href="Ledger.html#1111" class="Generalizable">t</a> <a id="1113" href="Ledger.html#1113" class="Generalizable">t′</a> <a id="1116" href="Ledger.html#1116" class="Generalizable">t″</a> <a id="1119" class="Symbol">:</a> <a id="1121" href="UTxO.html#1441" class="Record">Tx</a>
  <a id="1126" href="Ledger.html#1126" class="Generalizable">l</a> <a id="1128" href="Ledger.html#1128" class="Generalizable">l′</a> <a id="1131" href="Ledger.html#1131" class="Generalizable">l″</a> <a id="1134" href="Ledger.html#1134" class="Generalizable">l₁</a> <a id="1137" href="Ledger.html#1137" class="Generalizable">l₂</a> <a id="1140" class="Symbol">:</a> <a id="1142" href="UTxO.html#1732" class="Function">L</a>
  <a id="1146" href="Ledger.html#1146" class="Generalizable">ls</a> <a id="1149" href="Ledger.html#1149" class="Generalizable">ls′</a> <a id="1153" href="Ledger.html#1153" class="Generalizable">ls″</a> <a id="1157" class="Symbol">:</a> <a id="1159" href="UTxO.html#1732" class="Function">L</a> <a id="1161" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="1163" href="UTxO.html#1964" class="Function">S</a>

<a id="comp"></a><a id="1166" href="Ledger.html#1166" class="Function">comp</a> <a id="1171" class="Symbol">:</a> <a id="1173" class="Symbol">∀</a> <a id="1175" href="Ledger.html#1175" class="Bound">x</a> <a id="1177" class="Symbol">→</a> <a id="1179" href="Ledger.html#479" class="Field Operator">⟦</a> <a id="1181" href="Ledger.html#1126" class="Generalizable">l</a> <a id="1183" href="Data.List.Base.html#1810" class="Function Operator">++</a> <a id="1186" href="Ledger.html#1128" class="Generalizable">l′</a> <a id="1189" href="Ledger.html#479" class="Field Operator">⟧</a> <a id="1191" href="Ledger.html#1175" class="Bound">x</a> <a id="1193" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="1195" class="Symbol">(</a><a id="1196" href="Ledger.html#479" class="Field Operator">⟦</a> <a id="1198" href="Ledger.html#1128" class="Generalizable">l′</a> <a id="1201" href="Ledger.html#479" class="Field Operator">⟧</a> <a id="1203" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="1205" href="Ledger.html#479" class="Field Operator">⟦</a> <a id="1207" href="Ledger.html#1126" class="Generalizable">l</a> <a id="1209" href="Ledger.html#479" class="Field Operator">⟧</a><a id="1210" class="Symbol">)</a> <a id="1212" href="Ledger.html#1175" class="Bound">x</a>
<a id="1214" href="Ledger.html#1166" class="Function">comp</a> <a id="1219" class="Symbol">{</a><a id="1220" class="Argument">l</a> <a id="1222" class="Symbol">=</a> <a id="1224" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="1226" class="Symbol">}</a>    <a id="1231" class="Symbol">{</a><a id="1232" href="Ledger.html#1232" class="Bound">l′</a><a id="1234" class="Symbol">}</a> <a id="1236" href="Ledger.html#1236" class="Bound">x</a> <a id="1238" class="Symbol">=</a> <a id="1240" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="1245" href="Ledger.html#1166" class="Function">comp</a> <a id="1250" class="Symbol">{</a><a id="1251" class="Argument">l</a> <a id="1253" class="Symbol">=</a> <a id="1255" href="Ledger.html#1255" class="Bound">t</a> <a id="1257" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1259" href="Ledger.html#1259" class="Bound">l</a><a id="1260" class="Symbol">}</a> <a id="1262" class="Symbol">{</a><a id="1263" href="Ledger.html#1263" class="Bound">l′</a><a id="1265" class="Symbol">}</a> <a id="1267" href="Ledger.html#1267" class="Bound">x</a> <a id="1269" class="Keyword">rewrite</a> <a id="1277" href="Ledger.html#1166" class="Function">comp</a> <a id="1282" class="Symbol">{</a><a id="1283" href="Ledger.html#1259" class="Bound">l</a><a id="1284" class="Symbol">}{</a><a id="1286" href="Ledger.html#1263" class="Bound">l′</a><a id="1288" class="Symbol">}</a> <a id="1290" class="Symbol">(</a><a id="1291" href="Ledger.html#479" class="Field Operator">⟦</a> <a id="1293" href="Ledger.html#1255" class="Bound">t</a> <a id="1295" href="Ledger.html#479" class="Field Operator">⟧</a> <a id="1297" href="Ledger.html#1267" class="Bound">x</a><a id="1298" class="Symbol">)</a> <a id="1300" class="Symbol">=</a> <a id="1302" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="1308" class="Comment">-- ** Lemmas about the transfer operation on maps.</a>
<a id="1359" class="Comment">-- transfer-helper : s₁ ♯ s₂ → B ∉ˢ s₂ → ⟦ tx ⟧ s₁ ♯ s₂</a>
<a id="1415" class="Comment">-- transfer-helper {s₁ = s₁}{s₂}{B}{A}{v} s₁♯s₂ B∉ = ♯-cong-pre [∣↦]-pre s₁♯s₂</a>
</pre></body></html>